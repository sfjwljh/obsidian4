- 习题：![[Pasted image 20220408152758.png]]
	1. B
	2. 错。第一种是DIS标准
	3. 错
	4. B
	5. AC
	6. 对
- 习题2：
	1. 以太网使用_*星形*_结构的拓扑
	2. 用户使用PPP协议与ISP建立连接时，若已经建立好物理链路，然后建立_*LCP链路*_
	3. ![[Pasted image 20220408153441.png]]每遇到5个连续的1就就补个0 
	4. 互联网提供的电子邮件服务一定是透明传输。*错误*，因为邮件有时会被拒收，而透明传输不允许这发生
	5. （封装成帧）![[Pasted image 20220408154144.png]]
- **CSMA/CD工作原理**
	- 发送数据前 先侦听信道是否空闲 ,若空闲， 则立即发送数据。若信道忙碌，则等待一段 时间至信道中的信息传输结束后再发送数据 
	- 发送过程中若侦听到冲突,则立即停止发送 数据，等待一段随机时间,再重新尝试。 
	- 总结为：*先听后发，边发边听，冲突停发， 随机延迟后重发。*
- **载波监听多点接入/碰撞检测 CSMA/CD**
	- CSMA/CD - Carrier Sense Multiple Access with Collision Detection。 
	- “*多点接入*”：许多计算机（站）以多点接 入的方式连接在一根总线上。 
	- “*载波监听*”：每一个站在发送数据之前先 要检测总线上是否有其他计算机在发送数据， 如果有，则暂时不要发送数据，以免发生碰 撞。 
	- “载波监听”就是用电子技术检测总线上 有没有其他计算机发送的数据信号。
- **碰撞检测**
	- “碰撞检测” ：计算机边发送数据边检测信道上的*信 号电压大小*。 
	- 当几个站同时在总线上发送数据时，总线上的信号电 压*摆动值将会增大*（互相叠加）。 
	- 当一个站检测到的信号电压摆动值超过一定的门限值 时，就认为总线上至少有两个站同时在发送数据，表 明产生了碰撞。 
	- 所谓“碰撞”就是发生了冲突。因此“碰撞检测”也 称为“冲突检测” 。
- **检测到碰撞后 在发生碰撞时**
	- 总线上传输的信号产生了严 重的失真，无法从中恢复出有用的信息。 
	- 每一个正在发送数据的站，一旦发现总线上 出现了碰撞，就要立即停止发送，免得继续 浪费网络资源，然后等待一段随机时间后再 次发送。
- **电磁波在总线上的 有限传播速率的影响**
	- 当某个站监听到总线是空闲时，也可能总 线*并非真正是空闲的*。 
	- A 向 B 发出的信息，要*经过一定的时间后* 才能传送到 B。 
	- B 若在 A 发送的信息到达 B 之前发送自 己的帧(因为这时 B 的载波监听检测不到 A 所发送的信息)，则必然要在某个时间和 A 发送的帧发生碰撞。 
	- 碰撞的结果是两个帧都变得无用。![[Pasted image 20220408155037.png]]
- **重要特性**
	- 使用 CSMA/CD 协议的以太网*不能进行全双工* 通信，*只能进行双向交替*通信（半双工通 信）。 
	- 每个站在发送数据之后的一小段时间内，存 在着遭遇碰撞的可能性。 
	- 这种发送的不确定性使整个以太网的平均通 信量远小于以太网的最高数据率。（*速度慢*）
- ***争用期***
	- 最先发送数据帧的站，在发送数据帧后至多 经过时间 $2\tau$（*两倍的端到端往返时延*）就 可知道发送的数据帧是否遭受了碰撞。 
	- 以太网的端到端往返时延 $2\tau$称为**争用期**， 或**碰撞窗口**。 
	- 经过争用期这段时间还没有检测到碰撞，才 能**肯定**这次发送不会发生碰撞。
- **二进制指数类型退避算法**
	- 发生碰撞的站在停止发送数据后，要推迟 （退避）一个随机时间才能再发送数据。 
	- 确定基本退避时间，一般是取为争用期 $2\tau$。 
	- 定义重传次数 k ，k  10，即 k = Min[重传次数, 10] 
	- 从整数集合[0,1,…, (2k 1)]中随机地取出一个数， 记为 r。重传所需的时延就是 r 倍的基本退避时 间。 
	- 当重传达 16 次仍不能成功时即丢弃该帧，并向 高层报告。
- **争用期的长度**
	- 以太网取 51.2 $\mu s$ 为争用期的长度。 (经验值)
	- 对于 10 Mb/s 以太网，在争用期内可发送 512 bit，即 64 字节。 
	- 以太网在发送数据时，若前 64 字节没有 发生冲突，则后续的数据就不会发生冲突。
- **最短有效帧长**
	- 如果发生冲突，就一定是在发送的前 64 字 节之内。 
	- 由于一检测到冲突就立即中止发送，这时已 经发送出去的数据*一定小于 64 字节*。 
	- 以太网规定了最短有效帧长为 64 字节，凡 长度小于 64 字节的帧都是由于冲突而异常 中止的***无效帧***。
- **强化碰撞**：当发送数据的站一旦发现发生了碰撞时： 
	- 立即停止发送数据； 
	- 再继续发送若干比特的人为干扰信号(jamming signal)，以便让所有用户都知道现在已经发生 了碰撞。![[Pasted image 20220408160215.png]]
- 综上，可以将CSMA-CD的要点归纳为：
	1. 准备发送：适配器从网络层获得一个分组，加 上以太网的首部和尾部，组成以太网帧，放入 适配器的缓存中； 
	2. 检测信道，若信道忙，则不停地检测，直到 信道转为空闲，若检测到信道空闲，则等待96 比特时间，然后发送帧； 
	3. 在发送过程中仍不停地检测信道，若在争用 期内都没有检测到冲突，则成功发送，若检测 到冲突，则执行指数退比算法，等待r倍的512 比特时间，然后再重发，重发16次均失败则放 弃帧，向高层（网络层）汇报。
- 习题：
	1. 以太网发送的数据使用___编码的信号。 曼彻斯特
	2. CSMA/CD中“载波”指的是频分复用FDM 的载波。错误
	3. 在以太网中发生了碰撞表明这时一定出现了某种 故障。错误（碰撞很正常，不一定是网络有问题）
	4. 不可能
	5. 要发送的数据为101110。采用CRC的生成多项式 是$P(X)=X^{3}+1$,试求在数据后面的余数。
		- 除数：根据$P(X)=X^{3}+1$知道为1001
		- 被除数要补零，补4-1=3个数
		- 然后101110 000/1001=011（取模不进位的除法）![[Pasted image 20220408162819.png]]
## 3.4 使用广播信道的以太网
### 3.4.1 使用集线器的星形拓扑
- 传统以太网最后发展成使用更便宜和更灵活的*双绞线*。
-  以太网采用*星形拓扑*，在星形的中心增加了一种可靠性 非常高的设备，叫做**集线器**(hub) 
- hub 轮轴； 中心，焦点； （电器面板上的）电 线插孔； 集线器![[Pasted image 20220408161409.png]]
- **星形网 10BASE-T**
	- 不用电缆而使用无屏蔽双绞线。 每个站需要用两对双绞线，分别用于发送 和接收。 
	- 集线器使用了大规模集成电路芯片，因此 这样的硬件设备的可靠性已大大提高了。
- *以太网在局域网中的统治地位*
	- 10BASE-T 的通信距离稍短，每个站到集线器的距离 不超过 100 m。
	- 这种 10 Mb/s 速率的无屏蔽双绞线星形网的出现， 既降低了成本，又提高了可靠性。
	- 10BASE-T 双绞线以太网的出现，是局域网发展史上 的一个非常重要的里程碑，它为以太网在局域网中的 统治地位奠定了牢固的基础。
- *集线器*的一些**特点**
	- 集线器是使用*电子器件*模拟实际电缆线进行工作， 整个系统仍然像一个传统的以太网一样运行。 
	- 使用集线器的以太网在**逻辑上仍是一个总线网**，各 工作站使用的还是 `CSMA/CD 协议`，并共享逻辑 上的总线。 
	- 集线器很像一个多接口的转发器，**工作在物理层**。
	- 具有三个接口的集线器（PAGE 85/87）![[Pasted image 20220408161749.png]]
	- 集线器、交换机、路由器的区别：
		- 集线器：
			- 将局域网上的设备连接起来
			- 将收到的信息全部发给所有人
			- 不过滤，不选择，不安全，易拥堵
		- 交换器
			- 也是用于局域网
			- 相比于集线器，有“智能”，能识别mac地址
			- 知道各个主机的地址，不会把收到的信息发给所有人，而是根据地址发给指定的人
		- 路由器
			- 上面两个只能用于局域网，无法读取IP地址，连上互联网
			- 路由器可以识别数据的IP地址，并进行网络和网络间的通信。（不是发给本网络的数据拒收，是发给本网络的就收取进来）
			- 路由器其实就是一个*网关*
		- ![[Pasted image 20220408162430.png]]
		- 集线器和交换机用于创建网络，路由器用于链接网络
### 3.4.2 以太网的信道利用率
- 以太网的信道被占用的情况： 
	- 争用期长度为 $2\tau$，即端到端传播时延的两倍。 
	- 检测到碰撞后不发送干扰信号。 
	- 帧长为 L (bit)，数据发送速率为 C (b/s)，因而帧 的发送时间(不是传输时间）为$L \div C = T_{0} (s)$。
- 一个帧从开始发送，经可能发生的碰撞后，将再重 传数次，到发送成功且信道转为空闲(即再经过时间 $\tau$使得信道上无信号在传播)时为止，是发送一帧 所需的平均时间。
- ***参数 a***
	- 要提高以太网的信道利用率，就必须减小 $\tau$与 $T_{0}$ 之比。 
	- 在以太网中定义了参数 a：以太网单程端到端时延 $\tau$与帧的发送时间 T0 之比：$$a=\frac{\tau}{T_{0}}$$
	- a→0: 表示一发生碰撞立即可以检测出来， 并立即停止发送，因而信道利用率很高。 
	- a 越大:表明争用期所占的比例增大，每发 生一次碰撞就浪费许多信道资源，使得信道 利用率明显降低。
- *对以太网参数的要求*
	- 当数据率一定时，以太网连线的长度受到限 制，否则 $\tau$的数值会太大。 
	- 以太网的帧长不能太短，否则 T0 的值会太小， 使 a 值太大。 （T0=L/C）
- **信道利用率的最大值** $S_{max}$
	- 在理想化的情况下，以太网上的各站发送数据都不 会产生碰撞（这显然已经不是 CSMA/CD，而是需要 使用一种特殊的调度方法），即总线一旦空闲就有 某一个站立即发送数据。
	- 发送一帧占用线路的时间是 T0 + $\tau$，而帧本身的发 送时间是 T0。于是我们可计算出**理想情况**下的极限 信道利用率 Smax为：$$S_{max}=\frac{T_{0}}{T_{0}+\tau}=\frac{1}{1+a}$$
### 3.4.3 以太网的 MAC 层
1. *MAC 层的硬件地址*
	- 在局域网中，*硬件地址*又称为*物理 地址*，或 MAC 地址。 
	- 802 标准所说的“地址”严格地讲 应当是每一个站的“名字”或标识 符。
	- 48 位的 MAC 地址
		- 高位 24 位：IEEE 的注册管理机构 RA 负责向厂家分配 地址字段的前三个字节。 
		- 低位 24 位：地址字段中的后三个字节由厂家自行指派-- 扩展标识符，保证生产出的适配器没有重复地址。 
		- 一个地址块：可以生成$2^{24}$个不同的地址。
		-  “MAC地址”：实际上就是适配器地址或适配器标识符 EUI-48。这种 48 位地址称为 MAC-48，通称EUI-48。
		- 一个网卡的MAC地址:44-45-53-54-00-00
	- **适配器检查 MAC 地址**
		- 适配器从网络上每收到一个 MAC 帧首先用硬 件检查 MAC 帧中的 MAC 地址。 
			- 如果是发往本站的帧则收下，再进行其他的处理。 
			- 否则将此帧丢弃，不再进行其他的处理。 
		- “发往本站的帧”包括以下三种帧： 
			- 单播(unicast)帧（一对一） 
			- 广播(broadcast)帧（一对全体） 
			- 多播(multicast)帧（一对多）
2. *MAC 帧的格式*
	- 常用的以太网MAC帧格式有两种标准 ： 
		- DIX Ethernet V2 标准 
		- IEEE 的 802.3 标准 
	-  最常用的 MAC 帧是以太网 V2 的格式。
	- ![[Pasted image 20220408164318.png]]
		- 首部：6+6+2（两个地址是mac地址，48位二进制，等于6字节）
		- 尾部：4（校验码）FCS 字段 4 字节，生成多项式：CRC-32
		- IP数据报最小值46：以太网中每一帧最短64字节，64-首部长度-尾部长度=46
		- **类型**字段用来标志上一层使用的是什么协议， 以便把收到的 MAC 帧的数据上交给上一层的这个协议
		- 为了达到比特同步， 在传输媒体上实际传送的 要比 MAC 帧还**多 8 个字节**。在帧的前面插入的 8 字节中的第一个字段共 7 个字节， 是**前同步码**，用来迅速实现 MAC 帧的比特同步。 第二个字段是帧开始定界符，表示后面的信息就是MAC 帧。
	- *无效*的 MAC 帧
		- 数据字段的长度与长度字段的值不一致； 
		- 帧的长度不是整数个字节； 
		- 用收到的帧检验序列 FCS 查出有差错； 
		- 数据字段的长度不在 46 ~ 1500 字节之间。 
		- 有效的 MAC 帧长度为 64 ~ 1518 字节之间。 
		- 对于检查出的无效 MAC 帧就简单地丢弃。以太网**不 负责重传丢弃的帧**。
	- 帧间最小间隔：
		- 帧间最小间隔为 9.6 $\mus$，相当于 96 bit 的发送时 间。 
		- 一个站在检测到总线开始空闲后，还要等待 9.6 $\mu s$ 才能再次发送数据。 
		- 目的是为了使刚收到数据帧的站的接收缓存来得及清 理，做好接收下一帧的准备。
- 练习：![[Pasted image 20220408165330.png]]
	1. 正确
	2. 错误，对于路由器，要连接两个网络，则一定要有两个硬件地址，两个适配器
	3. 错误。64+8（前同步码）=72
	4. 错误。每发一帧，要等一会儿9.6$\mu s$，不然接收端来不及接受
	5. 6
## 3.5 扩展的局域网
### 3.5.1 在物理层扩展局域网
### 3.5.2 在数据链路层扩展局域网
- 在*数据链路层*使用网桥扩展局域网
- 网桥工作在数据链路层，它根据 MAC 帧的目的地址对 收到的帧进行转发
- 网桥具有过滤帧的功能。 
	- 当网桥收到一个帧时，并不是向所有的接口转发此帧，而是先检 查此帧的目的 MAC 地址，然后再确定将该帧转发到哪一个接口
1. 网桥的内部结构（PAGE 93/95）![[Pasted image 20220408170409.png]]
	- 使用网桥带来的好处(相比于集线器)
		- 过滤通信量。 
		- 扩大了物理范围。 
		- 提高了可靠性。 
		- 可互连不同物理层、不同 MAC 子层和*不同速率* （如10 Mb/s 和 100 Mb/s 以太网）的局域网（。集线器不行）
		- 网桥使各网段成为隔离开的碰撞域（集线器是一个大的碰撞域）![[Pasted image 20220408170844.png]]
	- 网桥的缺点：
		- 存储转发增加了时延。 （每次都要判断）
		- 在MAC 子层并没有流量控制功能。 
		- 具有不同 MAC 子层的网段桥接在一起时时延更大。 
		- 只适合于用户数不太多(不超过几百个)和通信量 不太大的局域网，否则有时会因传播过多的广播 信息产生网络拥塞-所谓的广播风暴。
	- *网桥不改变它转发的帧的源地址*![[Pasted image 20220408170956.png]]
	- 网桥和集线器（或转发器）不同
		- 集线器转发给所有人，网桥只转发给指定的人
		- 集线器在转发帧时，不对传输媒体进行检 测,使用物理层协议。 
		- 网桥在转发帧之前必须执行 CSMA/CD 算法。 （因为是链路层）
			- 若在发送过程中出现碰撞，就必须停止发送和 进行退避。
2. **透明网桥**
	- 目前使用得最多的网桥是透明网桥(transparent bridge)。 
	- “透明”是指局域网上的站点并不知道所发送的 帧将经过哪几个网桥，因为网桥对各站来说是看 不见的。 
	- 透明网桥是一种*即插即用*设备，其标准是 IEEE 802.1D。
- ***网桥自学习算法和建立转发表***Q
	- 若从 A 发出的帧从接口 x 进入了某网桥，那么从这个接口 出发沿相反方向一定可把一个帧传送到 A。 
	- 网桥每收到一个帧，记下其源地址和进入网桥的接口，作为 转发表中的一个项目。 
	- 在建立转发表时是把帧首部中的源地址写在“地址”这一栏 的下面。 
	- 在转发帧时，则是根据收到的帧首部中的目的地址来转发的。这时就把 在“地址”栏下面已经记下的源地址当作目的地址，而把记下的进入接 口当作转发接口。![[Pasted image 20220408171504.png]]
- 网桥在转发表中登记以下三个信息：
	- 在网桥的转发表中写入的信息除了*地址*和*接口*外， 还有帧进入该网桥的*时间*。（ 站表可能过时了）
	- 因以太网的拓扑可能经常发生变化，站点可能会 更换适配器（会改变站点的地址）。另外，以太 网上的工作站并非总是接通电源的。 
	- 把每个帧到达网桥的时间登记下来，可以在转发 表中只保留网络拓扑的最新状态信息。使得网桥 中的转发表能反映当前网络的最新拓扑状态。
- 网桥的自学习和转发帧的**步骤归纳**
	1. 收到一帧后先进行自学习。查找转发表中与收到 帧的源地址有无相匹配的项目。 
		- 无，增加一个项目（源地址、进入的接口和时间）。 
		- 有，更新原有的项目。
	2. 转发帧。查找目的地址有无相匹配的项目。
		- 无：从所有其他接口（入口除外）向外转发。 
		-  有：按转发表中给出的接口进行转发
- **透明网桥使用了生成树算法**
	- 为了避免产生转发的帧在网络中不断地兜圈子。![[Pasted image 20220408171854.png]]
	- 数据结构，最小生成树
	- 生成树的得出
		- 互连网桥在进行通信后，能找出原网络拓扑的一个子集-- -整个连通的网络中不存在回路，即在任何两个站之间只 有一条路径。 
		- 避免产生转发的帧在网络中不断地兜圈子。 
		- 得出能够反映网络拓扑发生变化时的生成树，在生成 树上的根网桥每隔一段时间要对生成树的拓扑进行更 新。
3. **源路由网桥**
	- 源路由(source route)网桥在发送帧时*将详细的路由信息放 在帧的首部*。
	-  源站以广播方式向欲通信的目的站发送一个发现帧，每个发现 帧都记录所经过的路由。 
	- 发现帧到达目的站时就沿各自的路由返回源站。 
	- 源站得知路由后，从所有路由中*选出一个最佳路由*。 
	- 该源站向该目的站发送的帧的首部，必携带源站所确定的路由 信息。
4. **多接口网桥——以太网交换机**
	- 1990 年问世的交换式集线器(switching hub)，可明 显地提高局域网的性能。 
	- *交换式集线器*（不是单单的集线器）常称为以太网交换机(switch)或第二层交 换机（表明此交换机工作在数据链路层）。 
	- 以太网交换机通常都有十几个接口。因此，以太网交换 机实质上就是一个多接口的网桥，可见交换机工作在数 据链路层。
	- 交换机的工作原理：
		- 就像一个物流管理中心
	- 以太网交换机的**特点**：
		- 以太网交换机的每个接口都直接与主机相连，并且一般 都工作在*全双工方式*（**无碰撞**）。 
		- 交换机能同时连通许多对的接口，使每一对相互通信的 主机都能像独占通信媒体那样，进行无碰撞地传输数据。
		-  以太网交换机由于使用了专用的交换结构芯片，其交换 速率就较高。
	- 独占传输媒体的带宽：
		- 对于普通 10 Mb/s 的共享式以太网，若共有 N 个用 户，则每个用户占有的平均带宽只有总带宽(10 Mb/s) 的 **N 分之一**。 
		- 使用以太网交换机时，虽然在每个接口到主机的带宽 还是 10 Mb/s，但由于一个用户在通信时是独占而不 是和其他网络用户共享传输媒体的带宽，因此对于拥 有 N 对接口的交换机的总容量为 **N·10**Mb/s。这正是 交换机的最大优点。
	- 交换机在同一时刻进行多个端口对之间的数据传输。 
	- 端口可视为**独立**的网段，连接在其上的网络设备独自**享有全 部的带宽**，无须同其他设备竞争使用。 
	- *举例*： 
		- 当A向D发送数据时，B可同时向C发送数据，且这两个传 输都享有网络的全部带宽，有自己的虚拟连接。 
		- 若使用10Mbps的以太网交换机，那么该交换机这时的总 流通量就等于2×10Mbps＝20Mbps，而使用10Mbps的共享 式HUB时，一个HUB的总流通量也不会超出10Mbps。
	- 利用以太网交换机可以很方便地实现*虚拟局域网*（虚拟局域网是局域网的一种服务，而不是新型的局域网）
		- 虚拟局域网 VLAN 是由一些局域网网段构成的与物理 位置无关的逻辑组。 
			- 这些网段具有某些共同的需求。 
			- 每一个 VLAN 的帧都有一个明确的标识符，指明发送这个帧 的工作站是属于哪一个 VLAN。 
		- **虚拟局域网其实只是局域网给用户提供的一种服务， 而并不是一种新型局域网**对原局域网再重新划分![[Pasted image 20220408173942.png]]